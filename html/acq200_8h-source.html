<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ACQ200 HOSTDRV: acq200.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>acq200.h</h1><a href="acq200_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ------------------------------------------------------------------------- */</span>
<a name="l00002"></a>00002 <span class="comment">/* acq200.h header for driver toplevel for acq200 peripheral                 */</span>
<a name="l00003"></a>00003 <span class="comment">/* ------------------------------------------------------------------------- */</span>
<a name="l00004"></a>00004 <span class="comment">/*   Copyright (C) 2006 Peter Milne, D-TACQ Solutions Ltd</span>
<a name="l00005"></a>00005 <span class="comment"> *                      &lt;Peter dot Milne at D hyphen TACQ dot com&gt;</span>
<a name="l00006"></a>00006 <span class="comment">                                                                               </span>
<a name="l00007"></a>00007 <span class="comment"> This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment"> it under the terms of Version 2 of the GNU General Public License</span>
<a name="l00009"></a>00009 <span class="comment"> as published by the Free Software Foundation;</span>
<a name="l00010"></a>00010 <span class="comment">                                                                               </span>
<a name="l00011"></a>00011 <span class="comment"> This program is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment"> but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment"> GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment">                                                                               </span>
<a name="l00016"></a>00016 <span class="comment"> You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> along with this program; if not, write to the Free Software</span>
<a name="l00018"></a>00018 <span class="comment"> Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.                */</span>
<a name="l00019"></a>00019 <span class="comment">/* ------------------------------------------------------------------------- */</span>
<a name="l00020"></a>00020 
<a name="l00025"></a>00025 <span class="preprocessor">#ifndef __ACQ200_H__</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#define __ACQ200_H__</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;linux/list.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;linux/kthread.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;linux/version.h&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="streambuf_8h.html">streambuf.h</a>"</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/* kernel compatibility ugliness */</span>
<a name="l00035"></a>00035 <span class="preprocessor">#if (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,27))</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="preprocessor">#define CLASS_DEVICE            device</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#define CLASS_DEVICE_CREATE     device_create</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#define CLASS_DEVICE_ATTR       DEVICE_ATTR</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#define CLASS_DEVICE_CREATE_FILE DEVICE_CREATE_FILE</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00042"></a><a class="code" href="acq200_8h.html#28514722ed2aeea61e16536572d21247">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define ORIGINAL_CLASS_DEVICE_INTERFACE 1</span>
<a name="l00043"></a><a class="code" href="acq200_8h.html#26d051a455c8adc1c3479a32f29ee40f">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define CLASS_DEVICE            class_device</span>
<a name="l00044"></a><a class="code" href="acq200_8h.html#60e33ca7d6712c05d8f27c1c029dd17d">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define CLASS_DEVICE_CREATE     class_device_create</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="preprocessor">#endif</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="acq200_8h.html#f1fc29e2f8a6cd96312b533431ec5427">00048</a> <span class="preprocessor">#define NMAPPINGS 4</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>
<a name="l00050"></a>00050 <span class="comment">/* @@todo - select on subvendor as well as vendor ... */</span>
<a name="l00051"></a><a class="code" href="acq200_8h.html#e5cbac18426de479aa21a433d467ddc4">00051</a> <span class="preprocessor">#define IS_ACQ196(ent) ((ent)-&gt;vendor == PCI_VENDOR_ID_INTEL)</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>
<a name="l00053"></a><a class="code" href="acq200_8h.html#a457a45843e1af1f983325f51bc7c608">00053</a> <span class="preprocessor">#define DEV_TYPE_ACQ32  0x0100</span>
<a name="l00054"></a><a class="code" href="acq200_8h.html#ea3ad73aa8e2463d1850d61d0322b95c">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define DEV_TYPE_ACQ16  0x0200</span>
<a name="l00055"></a><a class="code" href="acq200_8h.html#bb7b134f5b498da960e784b0bd390a08">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define DEV_TYPE_ACQ196 0x1000</span>
<a name="l00056"></a><a class="code" href="acq200_8h.html#d52c9937c0df4b11b5fe87d5b7ffb53f">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define DEV_TYPE_ACQ164 0x1100</span>
<a name="l00057"></a><a class="code" href="acq200_8h.html#51456ae2ce16928f7daceae196e38211">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define DEV_TYPE_WAV232 0x2000</span>
<a name="l00058"></a><a class="code" href="acq200_8h.html#1a4073d01ec0f71e4d305ad632249b87">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define DEV_TYPE_ACQ216 0x2100</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="keyword">struct </span><a class="code" href="structAcq200Path.html">Acq200Path</a>;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="keyword">struct </span><a class="code" href="structMESSAGE.html" title="I2O message handling.">MESSAGE</a>;
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="acq200_8h.html#1978ef6d5bc7b091000a268aa7369dca">00066</a> <span class="preprocessor">#define RCH_KB_POOL     1</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="structRchReturn.html">00069</a> <span class="keyword">struct </span><a class="code" href="structRchReturn.html">RchReturn</a> {
<a name="l00070"></a><a class="code" href="structRchReturn.html#390f87dedc8c477214d5afd8bcf871ca">00070</a>         <span class="keywordtype">int</span> <a class="code" href="structRchReturn.html#390f87dedc8c477214d5afd8bcf871ca">valid</a>;
<a name="l00071"></a><a class="code" href="structRchReturn.html#448110c42fb2646898dd98b20d496e9e">00071</a>         <span class="keywordtype">unsigned</span> <a class="code" href="structRchReturn.html#448110c42fb2646898dd98b20d496e9e">start_id</a>;
<a name="l00072"></a><a class="code" href="structRchReturn.html#7519da9761c468809b44452af82dc561">00072</a>         <span class="keywordtype">int</span> <a class="code" href="structRchReturn.html#7519da9761c468809b44452af82dc561">nbytes</a>;
<a name="l00073"></a><a class="code" href="structRchReturn.html#75852a6a83c12f2a66d16443503d2561">00073</a>         <span class="keyword">struct </span>IoMapping *<a class="code" href="structRchReturn.html#75852a6a83c12f2a66d16443503d2561">kbuf</a>;    <span class="comment">/* optional .. is there a kbuf here */</span>
<a name="l00074"></a><a class="code" href="structRchReturn.html#985caed3a9cb217b61e03834c0b93dd0">00074</a>         <span class="keywordtype">unsigned</span> <a class="code" href="structRchReturn.html#985caed3a9cb217b61e03834c0b93dd0">flags</a>;
<a name="l00075"></a>00075 };
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="structReturnCommandHandler.html">00077</a> <span class="keyword">struct </span><a class="code" href="structReturnCommandHandler.html">ReturnCommandHandler</a> {
<a name="l00078"></a>00078         void (*<a class="code" href="structReturnCommandHandler.html#e598646fd532e834fd5b0a002ab1c5da">handler</a>)( 
<a name="l00079"></a>00079                 <span class="keyword">struct </span><a class="code" href="structReturnCommandHandler.html">ReturnCommandHandler</a>* <span class="keyword">this</span>, 
<a name="l00080"></a>00080                 <span class="keyword">struct </span><a class="code" href="structMESSAGE.html" title="I2O message handling.">MESSAGE</a>* messsage );        
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="structReturnCommandHandler.html#78fc2efcf37079b0f75d94807737df99">00082</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Path.html">Acq200Path</a>* <a class="code" href="structReturnCommandHandler.html#78fc2efcf37079b0f75d94807737df99">path</a>;                        <span class="comment">// active path</span>
<a name="l00083"></a><a class="code" href="structReturnCommandHandler.html#0b4eafd65ac6d3d109793f6c1bdecc36">00083</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *<a class="code" href="structReturnCommandHandler.html#0b4eafd65ac6d3d109793f6c1bdecc36">device</a>;
<a name="l00084"></a><a class="code" href="structReturnCommandHandler.html#7c04dfabf080ce346117444580335595">00084</a>         <span class="keywordtype">short</span> <a class="code" href="structReturnCommandHandler.html#7c04dfabf080ce346117444580335595">command_id</a>;                              <span class="comment">// command id</span>
<a name="l00085"></a><a class="code" href="structReturnCommandHandler.html#420dc897af433e6f6d1c5fc8ab21dad4">00085</a>         <span class="keyword">struct </span><a class="code" href="structRchReturn.html">RchReturn</a> <a class="code" href="structReturnCommandHandler.html#420dc897af433e6f6d1c5fc8ab21dad4">rchReturn</a>;
<a name="l00086"></a><a class="code" href="structReturnCommandHandler.html#53386c9409662a5a643d3334962bb69e">00086</a>         spinlock_t *<a class="code" href="structReturnCommandHandler.html#53386c9409662a5a643d3334962bb69e">lock</a>;
<a name="l00087"></a>00087 
<a name="l00088"></a><a class="code" href="structReturnCommandHandler.html#8aec5ba0dfe7297a8c6601a5d531e2d8">00088</a>         <span class="keyword">struct </span>list_head <a class="code" href="structReturnCommandHandler.html#8aec5ba0dfe7297a8c6601a5d531e2d8">list</a>;  
<a name="l00089"></a>00089 };
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 
<a name="l00092"></a><a class="code" href="acq200_8h.html#3efb43d9bce4bdc0bbad6cd941f41f73">00092</a> <span class="preprocessor">#define MK_DMABUF_OFFSET(kbuf, device) \</span>
<a name="l00093"></a>00093 <span class="preprocessor">        (kbuf-&gt;pa &amp; PCI_WINDOW_MASK(&amp;device-&gt;dma_buf))</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a><a class="code" href="acq200_8h.html#c3a1837111170075cfaf10d3dd23a456">00095</a> <span class="preprocessor">#define USE_POOL 0</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a><a class="code" href="structDmaBuf.html">00097</a> <span class="keyword">struct </span><a class="code" href="structDmaBuf.html">DmaBuf</a> {
<a name="l00098"></a><a class="code" href="structDmaBuf.html#5959a6bacf5e06df4749d836c7676298">00098</a>         <span class="keywordtype">int</span> <a class="code" href="structDmaBuf.html#5959a6bacf5e06df4749d836c7676298">order</a>;
<a name="l00099"></a><a class="code" href="structDmaBuf.html#a0590c89317d41622971d58fd3275a1e">00099</a>         <span class="keywordtype">void</span> *<a class="code" href="structDmaBuf.html#a0590c89317d41622971d58fd3275a1e">va</a>;
<a name="l00100"></a><a class="code" href="structDmaBuf.html#bac2669718be53788e8b3b3a836bc76d">00100</a>         <span class="keywordtype">unsigned</span> <a class="code" href="structDmaBuf.html#bac2669718be53788e8b3b3a836bc76d">pa</a>;
<a name="l00101"></a>00101 };
<a name="l00102"></a><a class="code" href="acq200_8h.html#0d12880d1bb33f49494b7ee6ad57036b">00102</a> <span class="preprocessor">#define ORDER2LEN(order) ((1&lt;&lt;(order)) * PAGE_SIZE)</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>
<a name="l00104"></a><a class="code" href="acq200_8h.html#3fac3908ec9562ceda728e125cdcff79">00104</a> <span class="preprocessor">#define KNAME   32</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>
<a name="l00107"></a><a class="code" href="structAcq200Device.html">00107</a> <span class="keyword">struct </span><a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> {
<a name="l00108"></a><a class="code" href="structAcq200Device.html#bfbbb6f4856bedfec79360e43a5c6047">00108</a>         <span class="keywordtype">int</span> <a class="code" href="structAcq200Device.html#bfbbb6f4856bedfec79360e43a5c6047" title="card index in system.">idx</a>;                                
<a name="l00110"></a><a class="code" href="structAcq200Device.html#8f801e5f490ffef5e7bd08f4a29c9d24">00110</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Device.html#8f801e5f490ffef5e7bd08f4a29c9d24" title="linux pci generic.">pci_dev</a> *<a class="code" href="structAcq200Device.html#8f801e5f490ffef5e7bd08f4a29c9d24" title="linux pci generic.">pci_dev</a>;                
<a name="l00111"></a><a class="code" href="structAcq200Device.html#190b71a8087d48a3bf318d7377d41ce3">00111</a>         <span class="keyword">struct </span><a class="code" href="acq200_8h.html#26d051a455c8adc1c3479a32f29ee40f">CLASS_DEVICE</a> *<a class="code" href="structAcq200Device.html#190b71a8087d48a3bf318d7377d41ce3" title="class generic.">class_dev</a>;         
<a name="l00112"></a><a class="code" href="structAcq200Device.html#ee9da7117784d70e3645162674f6115a">00112</a>         <span class="keywordtype">int</span> <a class="code" href="structAcq200Device.html#ee9da7117784d70e3645162674f6115a">card_type</a>;
<a name="l00113"></a><a class="code" href="structAcq200Device.html#ca00241af3dc68ef26029dec6604314b">00113</a>         <span class="keywordtype">char</span> <a class="code" href="structAcq200Device.html#ca00241af3dc68ef26029dec6604314b">model_name</a>[<a class="code" href="acq200_8h.html#3fac3908ec9562ceda728e125cdcff79">KNAME</a>];
<a name="l00114"></a>00114         
<a name="l00115"></a><a class="code" href="structAcq200Device_1_1LogicalDev.html">00115</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Device_1_1LogicalDev.html">LogicalDev</a> {
<a name="l00116"></a><a class="code" href="structAcq200Device_1_1LogicalDev.html#9cafea203c979f1775adbbbc4542a2b1">00116</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1LogicalDev.html#9cafea203c979f1775adbbbc4542a2b1">major</a>;
<a name="l00117"></a><a class="code" href="structAcq200Device_1_1LogicalDev.html#c8a4852c56c6ce669a13228950896f84">00117</a>                 <span class="keywordtype">char</span> <a class="code" href="structAcq200Device_1_1LogicalDev.html#c8a4852c56c6ce669a13228950896f84">drv_name</a>[<a class="code" href="acq200_8h.html#3fac3908ec9562ceda728e125cdcff79">KNAME</a>];
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119                 <a class="code" href="structAcq200Device.html#b9f472c73ebb18379988925f717a4be5">ldev</a>;
<a name="l00120"></a>00120 
<a name="l00121"></a><a class="code" href="structAcq200Device.html#4e7aeb67c6f8979eee03c8c382cffc14">00121</a>         <span class="keyword">struct </span><a class="code" href="structDmaBuf.html">DmaBuf</a> <a class="code" href="structAcq200Device.html#4e7aeb67c6f8979eee03c8c382cffc14">dma_buf</a>;
<a name="l00122"></a><a class="code" href="structAcq200Device.html#e55e639729a0d2f18130ea92994b1595">00122</a>         <span class="keyword">struct </span><a class="code" href="structDmaBuf.html">DmaBuf</a> <a class="code" href="structAcq200Device.html#e55e639729a0d2f18130ea92994b1595">AB</a>[2];
<a name="l00123"></a><a class="code" href="structAcq200Device.html#bd6d3a9a8ceb27e801020a49740de14b">00123</a>         <span class="keyword">struct </span><a class="code" href="structBigBufPool.html">BigBufPool</a>* <a class="code" href="structAcq200Device.html#bd6d3a9a8ceb27e801020a49740de14b">pool</a>;
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="structAcq200Device_1_1IoMapping.html">00125</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Device_1_1IoMapping.html">IoMapping</a> {
<a name="l00126"></a><a class="code" href="structAcq200Device_1_1IoMapping.html#6cdab23a927eb6ff7672637b4bb3e8db">00126</a>                 <a class="code" href="local_8h.html#e0a7c37f5a766b8e881b7ca59f579d01">u32</a>* <a class="code" href="structAcq200Device_1_1IoMapping.html#6cdab23a927eb6ff7672637b4bb3e8db">va</a>;
<a name="l00127"></a><a class="code" href="structAcq200Device_1_1IoMapping.html#9f6ed61a7647812a664640f4b3396b89">00127</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structAcq200Device_1_1IoMapping.html#9f6ed61a7647812a664640f4b3396b89">pa</a>;
<a name="l00128"></a><a class="code" href="structAcq200Device_1_1IoMapping.html#c9343a0527f7d7204423ddb1bd36a959">00128</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1IoMapping.html#c9343a0527f7d7204423ddb1bd36a959">len</a>;
<a name="l00129"></a><a class="code" href="structAcq200Device_1_1IoMapping.html#ee30bdfa7b18c571776f522fc97f18ba">00129</a>                 <span class="keywordtype">char</span> <a class="code" href="structAcq200Device_1_1IoMapping.html#ee30bdfa7b18c571776f522fc97f18ba">name</a>[<a class="code" href="acq200_8h.html#3fac3908ec9562ceda728e125cdcff79">KNAME</a>];
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131                 <a class="code" href="structAcq200Device.html#0fffca5884db1af0bff2b363a65d229e">csr</a>, <a class="code" href="structAcq200Device.html#8a041c2df2d46e41ac0add102ab66bf4">ram</a>, <a class="code" href="structAcq200Device.html#cd0a40d015598b6666ef44ae387cc66b">rom</a>;
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="structAcq200Device.html#c33d6e91ff131d02afe2a673079147c8">00133</a>         <a class="code" href="local_8h.html#e0a7c37f5a766b8e881b7ca59f579d01">u32</a> <a class="code" href="structAcq200Device.html#c33d6e91ff131d02afe2a673079147c8">imask</a>;
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="structAcq200Device_1_1MailboxSync.html">00135</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Device_1_1MailboxSync.html">MailboxSync</a> {
<a name="l00136"></a><a class="code" href="structAcq200Device_1_1MailboxSync.html#94facc63387fb68f94986fc145827c67">00136</a>                 <span class="keywordtype">long</span> <a class="code" href="structAcq200Device_1_1MailboxSync.html#94facc63387fb68f94986fc145827c67">using_interrupt</a>;
<a name="l00137"></a><a class="code" href="structAcq200Device_1_1MailboxSync.html#ee5cd33f9b05d4792fc90234e61f595a">00137</a>                 <span class="keyword">struct </span>semaphore <a class="code" href="structAcq200Device_1_1MailboxSync.html#ee5cd33f9b05d4792fc90234e61f595a">mutex</a>;
<a name="l00138"></a><a class="code" href="structAcq200Device_1_1MailboxSync.html#52ebbf508e042512ba6b6c3bcc33e236">00138</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1MailboxSync.html#52ebbf508e042512ba6b6c3bcc33e236">response_received</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="structAcq200Device_1_1MailboxSync.html#86673ac9d0fc44d66fdb47bb4e470daf">00140</a>                 wait_queue_head_t <a class="code" href="structAcq200Device_1_1MailboxSync.html#86673ac9d0fc44d66fdb47bb4e470daf">waitq</a>;
<a name="l00141"></a>00141         } <a class="code" href="structAcq200Device.html#d4871b69d12a62f2cdecffc0e05ce483">mbox_sync</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="structAcq200Device_1_1Clients.html">00143</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Device_1_1Clients.html">Clients</a> {
<a name="l00144"></a><a class="code" href="structAcq200Device_1_1Clients.html#f9a56c3f4774c18c0b9a841e17c638ea">00144</a>                 <span class="keyword">struct </span>semaphore <a class="code" href="structAcq200Device_1_1Clients.html#f9a56c3f4774c18c0b9a841e17c638ea">mutex</a>;
<a name="l00145"></a><a class="code" href="structAcq200Device_1_1Clients.html#3c8167c38b6478d2f609e48e00df9bc7">00145</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1Clients.html#3c8167c38b6478d2f609e48e00df9bc7">count</a>;
<a name="l00146"></a>00146         } <a class="code" href="structAcq200Device.html#40c284b427882a09bae50845419d71a9">clients</a>;
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="structAcq200Device_1_1CHANNEL__INFO.html">00148</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Device_1_1CHANNEL__INFO.html">CHANNEL_INFO</a> {
<a name="l00149"></a><a class="code" href="structAcq200Device_1_1CHANNEL__INFO.html#8f9176afd8f0ed9db81ef5ae5faf9cb3">00149</a>                 <span class="keywordtype">unsigned</span> <a class="code" href="structAcq200Device_1_1CHANNEL__INFO.html#8f9176afd8f0ed9db81ef5ae5faf9cb3">nchannels</a>;        <span class="comment">// #channels available</span>
<a name="l00151"></a><a class="code" href="structAcq200Device_1_1CHANNEL__INFO.html#308b2159e04a33a1bb4c6659684cb653">00151</a> <span class="comment"></span>                <span class="keywordtype">short</span> <a class="code" href="structAcq200Device_1_1CHANNEL__INFO.html#308b2159e04a33a1bb4c6659684cb653">vmax10</a>;              <span class="comment">// vmax (volts*10)</span>
<a name="l00152"></a><a class="code" href="structAcq200Device_1_1CHANNEL__INFO.html#76a701fbbf812c8ef697176047a5ec21">00152</a>                 <span class="keywordtype">short</span> <a class="code" href="structAcq200Device_1_1CHANNEL__INFO.html#76a701fbbf812c8ef697176047a5ec21">vmin10</a>;              <span class="comment">// vmin (volts*10)</span>
<a name="l00153"></a>00153         }
<a name="l00154"></a>00154                 <a class="code" href="structAcq200Device.html#64b58781912381e9a8fbc4b88a08d791">input_channels</a>, <a class="code" href="structAcq200Device.html#8c807f090566ebff9deeeec11dc79d1f">output_channels</a>;
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="structAcq200Device.html#42a8a92ddc1c7381a97f2760d598bda8">00156</a>         <span class="keywordtype">int</span> <a class="code" href="structAcq200Device.html#42a8a92ddc1c7381a97f2760d598bda8">completed_onetime_setups</a>;
<a name="l00157"></a><a class="code" href="structAcq200Device.html#88ea19e031fb1a3550de3307c8d0a5bf">00157</a>         <span class="keywordtype">int</span> <a class="code" href="structAcq200Device.html#88ea19e031fb1a3550de3307c8d0a5bf">heartbeat_detected</a>;
<a name="l00158"></a><a class="code" href="structAcq200Device.html#ad5dbefa1409e4676ae1b22a91465625">00158</a>         <span class="keywordtype">int</span> <a class="code" href="structAcq200Device.html#ad5dbefa1409e4676ae1b22a91465625">interrupt_count</a>[4];
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html">00160</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Device_1_1DevicePrivateData.html">DevicePrivateData</a> {
<a name="l00161"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#096cb38354fe1f7330b5b6ce0d8f4ec3">00161</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#096cb38354fe1f7330b5b6ce0d8f4ec3">i2o_packets_incoming</a>;
<a name="l00162"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#c34c4e904bce4e21776f1144dcb9b39c">00162</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#c34c4e904bce4e21776f1144dcb9b39c">i2o_packets_returned</a>;
<a name="l00163"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#cf4ed43a3f2f2004aced97c4468cbfb0">00163</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#cf4ed43a3f2f2004aced97c4468cbfb0">i2o_packets_discarded</a>;
<a name="l00164"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#7ff0d92bca542d027abc47276ca75c90">00164</a>                 <span class="keywordtype">void</span>* <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#7ff0d92bca542d027abc47276ca75c90">i2o_last_in</a>;
<a name="l00165"></a>00165                 
<a name="l00166"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#8a861caa1667a9f6d942ef0214d70244">00166</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#8a861caa1667a9f6d942ef0214d70244">i2o_packets_outgoing</a>;       <span class="comment">// # command packets sent</span>
<a name="l00167"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#64ff59530785a009321c22929f5d1b30">00167</a>                 <span class="keywordtype">short</span> <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#64ff59530785a009321c22929f5d1b30">i2o_last_id_out</a>;              <span class="comment">// last id code</span>
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData_1_1rch.html">00169</a>                 <span class="keyword">struct </span><a class="code" href="structAcq200Device_1_1DevicePrivateData_1_1rch.html">rch</a> {
<a name="l00170"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData_1_1rch.html#5661c6cd5d2c1fd6474ebe93e41b9e7e">00170</a>                         spinlock_t <a class="code" href="structAcq200Device_1_1DevicePrivateData_1_1rch.html#5661c6cd5d2c1fd6474ebe93e41b9e7e">lock</a>;
<a name="l00171"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData_1_1rch.html#4086bc25e75c335ae16752a4f9761b6b">00171</a>                         <span class="keyword">struct </span>list_head <a class="code" href="structAcq200Device_1_1DevicePrivateData_1_1rch.html#4086bc25e75c335ae16752a4f9761b6b">list</a>;
<a name="l00172"></a>00172                 } <a class="code" href="structAcq200Device_1_1DevicePrivateData_1_1rch.html">rch</a>;
<a name="l00173"></a>00173 
<a name="l00174"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#70f86ace18e25709f72a0250dec08541">00174</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#70f86ace18e25709f72a0250dec08541">streaming_enabled</a>;
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#50a1b3a0194f1703b12bc9b44e147ed6">00176</a>                 <span class="keyword">struct </span>tasklet_struct <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#50a1b3a0194f1703b12bc9b44e147ed6">streaming_isr_tasklet</a>;
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#9d6b56c458835eb9031baff388e8ba2b">00178</a>                 <span class="keywordtype">unsigned</span> <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#9d6b56c458835eb9031baff388e8ba2b">aux_mfa</a>;
<a name="l00179"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#7ecaebba868b61d28dfdfb70c5cb7be5">00179</a>                 wait_queue_head_t <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#7ecaebba868b61d28dfdfb70c5cb7be5">aux_waitq</a>; 
<a name="l00180"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#d2a8ca662f01815914792ed240ffb78a">00180</a>                 <span class="keywordtype">int</span> <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#d2a8ca662f01815914792ed240ffb78a">aux_task_waiting</a>;
<a name="l00181"></a>00181 
<a name="l00182"></a><a class="code" href="structAcq200Device_1_1DevicePrivateData.html#dbb9ca63c7c058e9bc046ac3250d3b6f">00182</a>                 <span class="keywordtype">unsigned</span> <a class="code" href="structAcq200Device_1_1DevicePrivateData.html#dbb9ca63c7c058e9bc046ac3250d3b6f">bad_mfa_count</a>;
<a name="l00183"></a>00183         } <a class="code" href="structAcq200Device.html#a396d9dbbc60b994df11718be7ccae6f">m_dpd</a>;
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="structAcq200Device.html#be67f6063cbcd0fa69416562507f6cfa">00185</a>         <span class="keyword">struct </span><a class="code" href="structStreamBuf.html">StreamBuf</a> <a class="code" href="structAcq200Device.html#be67f6063cbcd0fa69416562507f6cfa">streambuf</a>;
<a name="l00186"></a><a class="code" href="structAcq200Device.html#98aaa92443fa4056287414acf49062d8">00186</a>         <span class="keyword">struct </span>task_struct *<a class="code" href="structAcq200Device.html#98aaa92443fa4056287414acf49062d8">i2o_backstop</a>;
<a name="l00187"></a>00187 };
<a name="l00188"></a>00188 
<a name="l00189"></a><a class="code" href="acq200_8h.html#8b3b5e1ed74a8c96f4d6400b0ead932c">00189</a> <span class="preprocessor">#define BAD_MFA_THRESHOLD 100</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>
<a name="l00191"></a>00191 <span class="comment">/*</span>
<a name="l00192"></a>00192 <span class="comment"> * MU shared defs for driver comms</span>
<a name="l00193"></a>00193 <span class="comment"> */</span>
<a name="l00194"></a>00194 
<a name="l00195"></a><a class="code" href="acq200_8h.html#5249bdee9fa4151f75af79f1bcd40ef5">00195</a> <span class="preprocessor">#define ACQ200_MAILBOX_0         0x10</span>
<a name="l00196"></a><a class="code" href="acq200_8h.html#38a1808d9e21c0b20665efbd60d4f454">00196</a> <span class="preprocessor"></span><span class="preprocessor">#define ACQ200_ODR               0x2c</span>
<a name="l00197"></a><a class="code" href="acq200_8h.html#9f602d098401c9f5e0683d8a385e4ba6">00197</a> <span class="preprocessor"></span><span class="preprocessor">#define ACQ200_OISR              0x30</span>
<a name="l00198"></a><a class="code" href="acq200_8h.html#bdc09bf55fb7b6cb499aa614343fcf92">00198</a> <span class="preprocessor"></span><span class="preprocessor">#define ACQ200_OIMR              0x34</span>
<a name="l00199"></a><a class="code" href="acq200_8h.html#138bb5796a4553089dcf997f35504924">00199</a> <span class="preprocessor"></span><span class="preprocessor">#define ACQ200_IQP               0x40</span>
<a name="l00200"></a><a class="code" href="acq200_8h.html#70fd12c854ca81951cd2afbc2ac93957">00200</a> <span class="preprocessor"></span><span class="preprocessor">#define ACQ200_OQP               0x44</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>
<a name="l00202"></a><a class="code" href="acq200_8h.html#3dd7165aff3c04db2f182fbb72cfad2d">00202</a> <span class="preprocessor">#define ACQ200_OISR_OM_0         0x01  </span><span class="comment">/* not used */</span>
<a name="l00203"></a><a class="code" href="acq200_8h.html#a8b8a9c5143ea26dd87d1cd818d47325">00203</a> <span class="preprocessor">#define ACQ200_OISR_OM_1         0x02  </span><span class="comment">/* not used */</span>
<a name="l00204"></a><a class="code" href="acq200_8h.html#7f8774f0ddca77f6b25353589176e7ce">00204</a> <span class="preprocessor">#define ACQ200_OISR_ODI          0x04  </span><span class="comment">/* we use this one */</span>
<a name="l00205"></a><a class="code" href="acq200_8h.html#7cf100874702916742f25b2300a4698e">00205</a> <span class="preprocessor">#define ACQ200_OISR_OPQI         0x08  </span>
<a name="l00206"></a><a class="code" href="acq200_8h.html#112c6829bdc1cd68832bc0b041a380ad">00206</a> <span class="preprocessor"></span><span class="preprocessor">#define ACQ200_OISR_PCI_INTA     0x10  </span><span class="comment">/* not obvious ?? */</span>
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="acq200_8h.html#bbfdca270c152632516a857702c07bb4">00208</a> <span class="preprocessor">#define PCI_I2O_INVALID_MFA         0xffffffff</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span>
<a name="l00210"></a><a class="code" href="acq200_8h.html#a45b5fde1c9a16a9ba751fc4f726165f">00210</a> <span class="preprocessor">#define CSR( dev, byte_off )    ((dev)-&gt;csr.va+(byte_off)/4)</span>
<a name="l00211"></a><a class="code" href="acq200_8h.html#cb093d10072ef64e5bcd26cd7a110fa4">00211</a> <span class="preprocessor"></span><span class="preprocessor">#define RESPONSE_RECEIVED(dev) ((dev)-&gt;mbox_sync.response_received != 0)</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span>
<a name="l00213"></a><a class="code" href="structAcq200Path.html">00213</a> <span class="keyword">struct </span><a class="code" href="structAcq200Path.html">Acq200Path</a> {
<a name="l00215"></a><a class="code" href="structAcq200Path.html#b6da8ef1e9979e3350a577a45bd5cf25">00215</a>         <span class="keywordtype">unsigned</span> <a class="code" href="structAcq200Path.html#b6da8ef1e9979e3350a577a45bd5cf25" title="&amp;lt; path descriptor, one per open path">minor</a>;                 <span class="comment">// customisation for this node</span>
<a name="l00216"></a><a class="code" href="structAcq200Path.html#1880232de8f511a0022cd1001fa026c7">00216</a>         <span class="keyword">struct </span><a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a>* <a class="code" href="structAcq200Path.html#1880232de8f511a0022cd1001fa026c7">device</a>;
<a name="l00217"></a><a class="code" href="structAcq200Path.html#c6985bbd76a5cddb1d1033d2932be21a">00217</a>         <span class="keyword">struct </span><a class="code" href="structDmaBuf.html">DmaBuf</a> <a class="code" href="structAcq200Path.html#c6985bbd76a5cddb1d1033d2932be21a">dma_buf</a>;
<a name="l00218"></a><a class="code" href="structAcq200Path.html#bded4bd91818cc7195e4320aceb34251">00218</a>         <span class="keywordtype">int</span> <a class="code" href="structAcq200Path.html#bded4bd91818cc7195e4320aceb34251">last_direction_hack</a>;
<a name="l00219"></a><a class="code" href="structAcq200Path.html#a8dd937e607517f43974c73bef9bff7e">00219</a>         wait_queue_head_t <a class="code" href="structAcq200Path.html#a8dd937e607517f43974c73bef9bff7e">return_waitq</a>;
<a name="l00220"></a><a class="code" href="structAcq200Path.html#f3c2528e3d806f94e0f883a85af0ca9f">00220</a>         <span class="keyword">struct </span><a class="code" href="structReturnCommandHandler.html">ReturnCommandHandler</a>* <a class="code" href="structAcq200Path.html#f3c2528e3d806f94e0f883a85af0ca9f">rchAB</a>[2];
<a name="l00221"></a><a class="code" href="structAcq200Path.html#fc90f8f6c9b17fdd389d3ec334e45ea7">00221</a>         <span class="keyword">struct </span>IoMapping <a class="code" href="structAcq200Path.html#fc90f8f6c9b17fdd389d3ec334e45ea7">bufferMappings</a>[2];
<a name="l00222"></a><a class="code" href="structAcq200Path.html#6385469d05bfcaae4ea38f6faaa43fac">00222</a>         <span class="keywordtype">int</span> <a class="code" href="structAcq200Path.html#6385469d05bfcaae4ea38f6faaa43fac">ab_next</a>;                            <span class="comment">/* BUFFERA, BUFFERB */</span>
<a name="l00223"></a><a class="code" href="structAcq200Path.html#b0686f47644ac9a794d83b8fc643f7cf">00223</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structAcq200Path.html#b0686f47644ac9a794d83b8fc643f7cf">sid</a>;
<a name="l00224"></a><a class="code" href="structAcq200Path.html#e87389d79ffdb2db364ea6c1e1eb13f5">00224</a>         <span class="keywordtype">char</span> <a class="code" href="structAcq200Path.html#e87389d79ffdb2db364ea6c1e1eb13f5">scratch</a>[2048];
<a name="l00225"></a>00225 };
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="acq200_8h.html#db1496512e477a5e5f2dea601088da4a">00227</a> <span class="preprocessor">#define PATH_HEAD (offsetof(struct Acq200Path, scratch))</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>
<a name="l00230"></a><a class="code" href="acq200_8h.html#c85bdadb1bb5f9ae659154c60d3095dd">00230</a> <span class="preprocessor">#define LDH_OUTBOUND 1</span>
<a name="l00231"></a><a class="code" href="acq200_8h.html#8d39c3b73a0c7fc197253f2c36ea010a">00231</a> <span class="preprocessor"></span><span class="preprocessor">#define LDH_INBOUND  -1</span>
<a name="l00232"></a><a class="code" href="acq200_8h.html#81a210fcb08de3cba797699f36482873">00232</a> <span class="preprocessor"></span><span class="preprocessor">#define LDH_NONE 0</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span>
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="acq200_8h.html#832919c1ceb8a77383de2ab5ab9b57e1">00235</a> <span class="preprocessor">#define ACQ200_ON_OPEN(inode, file)\</span>
<a name="l00236"></a>00236 <span class="preprocessor">        do { \</span>
<a name="l00237"></a>00237 <span class="preprocessor">                if ((PD(file)=acq200_makePathDescriptor(inode-&gt;i_rdev)) == 0)\</span>
<a name="l00238"></a>00238 <span class="preprocessor">                        return -ENODEV;\</span>
<a name="l00239"></a>00239 <span class="preprocessor">                else \</span>
<a name="l00240"></a>00240 <span class="preprocessor">                         DG(file)-&gt;bridge_dev.open_count++; \</span>
<a name="l00241"></a>00241 <span class="preprocessor">         } while(0)</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>
<a name="l00243"></a><a class="code" href="acq200_8h.html#0d004dfae3b2bdfa7eb376ada378800f">00243</a> <span class="preprocessor">#define ACQ200_ON_CLOSE(file) \</span>
<a name="l00244"></a>00244 <span class="preprocessor">        do { \</span>
<a name="l00245"></a>00245 <span class="preprocessor">                if (PD(file) != 0){ \</span>
<a name="l00246"></a>00246 <span class="preprocessor">                         acq200_freePathDescriptor(PD(file));\</span>
<a name="l00247"></a>00247 <span class="preprocessor">                         DG(file)-&gt;bridge_dev.open_count--;\</span>
<a name="l00248"></a>00248 <span class="preprocessor">                         PD(file) = 0;\</span>
<a name="l00249"></a>00249 <span class="preprocessor">                } \</span>
<a name="l00250"></a>00250 <span class="preprocessor">                return 0; \</span>
<a name="l00251"></a>00251 <span class="preprocessor">         } while(0)</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span>
<a name="l00253"></a><a class="code" href="acq200_8h.html#adbf54044b659f5fb7254cb3e6e3c269">00253</a> <span class="preprocessor">#define MBOX_OFFSET 0x10</span>
<a name="l00254"></a><a class="code" href="acq200_8h.html#9deb89c79d0668173341d05005746c42">00254</a> <span class="preprocessor"></span><span class="preprocessor">#define MBOX_OFFSETL (MBOX_OFFSET/sizeof(u32))</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="acq200_8h.html#26f637bc72fc19db21a0a7b770d9e008">00257</a> <span class="preprocessor">#define MBOX(device, ibox) (device-&gt;csr.va[MBOX_OFFSETL+(ibox)])</span>
<a name="l00258"></a>00258 <span class="preprocessor"></span>
<a name="l00259"></a><a class="code" href="acq200_8h.html#574aff393446e60c5cecac3cd86bbd91">00259</a> <span class="preprocessor">#define MBOX_WRITE(device, ibox, value)         \</span>
<a name="l00260"></a>00260 <span class="preprocessor">        iowrite32((value), &amp;MBOX(device, ibox))</span>
<a name="l00261"></a><a class="code" href="acq200_8h.html#dcb79fcc66b79db15f5ae356fc367c79">00261</a> <span class="preprocessor"></span><span class="preprocessor">#define MBOX_READ(device, ibox) ioread32(&amp;MBOX(device, ibox))</span>
<a name="l00262"></a>00262 <span class="preprocessor"></span>
<a name="l00263"></a>00263 
<a name="l00264"></a><a class="code" href="acq200_8h.html#367b8145419319e0a77bff9c5d8ff312">00264</a> <span class="preprocessor">#define PD(file)             ((struct Acq200Path*)file-&gt;private_data)</span>
<a name="l00265"></a><a class="code" href="acq200_8h.html#90f40077a3c072281c8d1c741b3b27c5">00265</a> <span class="preprocessor"></span><span class="preprocessor">#define DEV(file)            (PD(file)-&gt;device)</span>
<a name="l00266"></a><a class="code" href="acq200_8h.html#95d7e6b9c9e30a0444e293ff38fcd116">00266</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_PATH(file, path) (file-&gt;private_data = (path))</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span>
<a name="l00268"></a><a class="code" href="acq200_8h.html#f4dd52c83efc454fb3404caf3ce9d3b0">00268</a> <span class="preprocessor">#define LBUF(file) (PD(file)-&gt;scratch)</span>
<a name="l00269"></a>00269 <span class="preprocessor"></span>
<a name="l00270"></a><a class="code" href="acq200_8h.html#db330d36ca3a1492c310f0747783b893">00270</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#db330d36ca3a1492c310f0747783b893">dma_buf_len</a>(<span class="keyword">struct</span> <a class="code" href="structDmaBuf.html">DmaBuf</a> *dma_buf) 
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272         <span class="keywordflow">if</span> (dma_buf-&gt;<a class="code" href="structDmaBuf.html#a0590c89317d41622971d58fd3275a1e">va</a> != 0) {
<a name="l00273"></a>00273                 <span class="keywordflow">return</span> (1 &lt;&lt; dma_buf-&gt;<a class="code" href="structDmaBuf.html#5959a6bacf5e06df4749d836c7676298">order</a>) * PAGE_SIZE;
<a name="l00274"></a>00274         } <span class="keywordflow">else</span> {
<a name="l00275"></a>00275                 <span class="keywordflow">return</span> 0;
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="keyword">struct </span><a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a>* <a class="code" href="acq200_8c.html#8996c00a06d36d6eb7bd46a96a06d0c6">acq200_lookupDevice</a>(<span class="keyword">struct</span> device *dev);
<a name="l00282"></a>00282 <span class="keyword">struct </span><a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a>* <a class="code" href="acq200_8c.html#d2ab30da3ff5d958582d619962dc56c9">acq200_lookupDeviceFromClass</a>(<span class="keyword">struct</span> <a class="code" href="acq200_8h.html#26d051a455c8adc1c3479a32f29ee40f">CLASS_DEVICE</a> *dev);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#c9914252777b9cc3fc2583fcaa72daa9">acq200_create_sysfs_device</a>(<span class="keyword">struct</span> device *dev);
<a name="l00285"></a>00285 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#5ee5a4dcf3390366a905084bbc25dc51">acq200_remove_sysfs_device</a>(<span class="keyword">struct</span> device *dev);
<a name="l00286"></a>00286 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#4881a34fb3ae7edcdf68063aca42b0f7">acq200_create_sysfs_class</a>(<span class="keyword">struct</span> <a class="code" href="acq200_8h.html#26d051a455c8adc1c3479a32f29ee40f">CLASS_DEVICE</a> *dev);
<a name="l00287"></a>00287 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#6a7402ef6bd1b70ca15911f0041a0219">acq200_remove_sysfs_class</a>(<span class="keyword">struct</span> <a class="code" href="acq200_8h.html#26d051a455c8adc1c3479a32f29ee40f">CLASS_DEVICE</a> *dev);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#bc89aed0efec62b869e5b9a51b023133" title="mmap the host buffer.">acq200_mmap_host</a>(<span class="keyword">struct</span> file* file, <span class="keyword">struct</span> vm_area_struct* vma);
<a name="l00293"></a>00293 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#68ba2bda051ffd4b7f35693689d8bbef" title="mmap the host buffer.">acq200_mmapAB</a>(<span class="keyword">struct</span> file* file, <span class="keyword">struct</span> vm_area_struct* vma);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="keyword">struct </span><a class="code" href="structBufferAB__Ops.html">BufferAB_Ops</a>;
<a name="l00296"></a>00296 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#248fa118c9fe30de099908887a26bed4">acq200_bufferABaction</a>(<span class="keyword">struct</span> file *file, <span class="keyword">struct</span> <a class="code" href="structBufferAB__Ops.html">BufferAB_Ops</a> *ops);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#cc00c9c7b457eddc256e650c7e66c788" title="provide user mapping to mailboxes on target.">acq200_mmap_mbox</a>(<span class="keyword">struct</span> file* file, <span class="keyword">struct</span> vm_area_struct* vma);
<a name="l00304"></a>00304 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#fa88131122aaf8e89646311c5c0f2b6f" title="provide user mapping to mailboxes on target">acq200_map_pci_memory</a>(<span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a>* device);
<a name="l00309"></a>00309 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#a44f3320ac0a3246a51c3f336385a5b0" title="map remote regs area on device load">acq200_unmap_pci_memory</a>( <span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a>* device );
<a name="l00315"></a>00315 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#f703fe2649d0a5a82dd889a06ab96b44" title="unmap remote regs are on device unload">acq200_intsDisable</a>( <span class="keywordtype">unsigned</span> irqs );
<a name="l00318"></a>00318 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#0f8df2f9998403439cb6990ae4458945" title="enable interrupts defined by set bits in irqs">acq200_intsEnable</a>( <span class="keywordtype">unsigned</span> irqs );
<a name="l00321"></a><a class="code" href="acq200_8h.html#59279bee44f34d08b3cbf3a89fb0d8d9">00321</a> <span class="preprocessor">#define STATUS dbg(1, "STATUS line %d", __LINE__ )</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span>
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#20342da936753e6b4d5f472d91e5dac7">acq200_getHeartbeat</a>( <span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a>* device );
<a name="l00326"></a>00326 <span class="comment">// return heartbeat</span>
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 <span class="keywordtype">int</span> <a class="code" href="acq200_8c.html#ab76b862799f1e6af5502c9fdba4da11" title="send a command, single parameter">acq200_sendCommand</a>(<span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *device, <a class="code" href="local_8h.html#e0a7c37f5a766b8e881b7ca59f579d01">u32</a> command);
<a name="l00331"></a>00331 <span class="keywordtype">int</span> <a class="code" href="acq200_8c.html#eacefa5f771ea0315f8ac07a370d97ed" title="send a command with A3, A4 parameters">acq200_sendCommandA3A4</a>(
<a name="l00332"></a>00332         <span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *device, <a class="code" href="local_8h.html#e0a7c37f5a766b8e881b7ca59f579d01">u32</a> command, <a class="code" href="local_8h.html#e0a7c37f5a766b8e881b7ca59f579d01">u32</a> a3, <a class="code" href="local_8h.html#e0a7c37f5a766b8e881b7ca59f579d01">u32</a> a4);
<a name="l00336"></a><a class="code" href="acq200_8h.html#3f7687795df7b6ba88b4aa2b8f599224">00336</a> <span class="preprocessor">#define NULL_A3 NULL</span>
<a name="l00337"></a><a class="code" href="acq200_8h.html#053849dc59053fecc1862035548758dc">00337</a> <span class="preprocessor"></span><span class="preprocessor">#define NULL_A4 NULL</span>
<a name="l00338"></a>00338 <span class="preprocessor"></span>
<a name="l00339"></a>00339 <span class="keywordtype">int</span> <a class="code" href="acq200_8c.html#ddc57d3b652eac72b8eb2b760d11700b" title="send a query, pick up answers for aX != NULL">acq200_sendQuery</a>( 
<a name="l00340"></a>00340         <span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a>* device, 
<a name="l00341"></a>00341         <span class="keywordtype">unsigned</span> command, 
<a name="l00342"></a>00342         <span class="keywordtype">unsigned</span>* a1,
<a name="l00343"></a>00343         <span class="keywordtype">unsigned</span>* a2,
<a name="l00344"></a>00344         <span class="keywordtype">unsigned</span>* a3,
<a name="l00345"></a>00345         <span class="keywordtype">unsigned</span>* a4
<a name="l00346"></a>00346         );
<a name="l00350"></a>00350 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#28bbdbe1e24fcd41647ba19a99a10b78" title="send a query, pick up answers for aX != NULL">acq200_getAvailableChannels</a>(<span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a>* device);
<a name="l00355"></a>00355 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#b105d79940094fae27898bf817faed15">acq200_consume_i2o</a>(<span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a>* device, <a class="code" href="local_8h.html#e0a7c37f5a766b8e881b7ca59f579d01">u32</a> mfa );
<a name="l00356"></a>00356 
<a name="l00357"></a><a class="code" href="acq200_8h.html#75946d5b53eaafe4d5730ae2b986ef17">00357</a> <span class="preprocessor">#define TIMESTAMP(a, b, c)</span>
<a name="l00358"></a><a class="code" href="acq200_8h.html#af092a0694ac7496e82436fbc1ac0d6e">00358</a> <span class="preprocessor"></span><span class="preprocessor">#define ACQ200_PCIWINSZ  0x01000000</span>
<a name="l00359"></a><a class="code" href="acq200_8h.html#3fe5cee0ae26dde8a2c3419bc5b6250c">00359</a> <span class="preprocessor"></span><span class="preprocessor">#define ACQ200_PCIWINMSK (ACQ200_PCIWINSZ-1)</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span>
<a name="l00361"></a>00361 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#3b81380bce63f4b2d207ad996588c76c">acq200_streaming_isr_bh</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> clidata);
<a name="l00362"></a>00362 ssize_t <a class="code" href="acq200_8h.html#d8d3ab3b9520f0d2e8b82a2a5cbc766d">acq200_bridge_write</a>(
<a name="l00363"></a>00363         <span class="keyword">struct</span> file *file, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> count, loff_t * posp);
<a name="l00364"></a>00364 ssize_t <a class="code" href="acq200_8h.html#1a938405d31b1afbe3caddb19bcd5e35">acq200_bridge_read</a> (
<a name="l00365"></a>00365         <span class="keyword">struct</span> file* file, <span class="keywordtype">char</span>* buf, <span class="keywordtype">size_t</span> count, loff_t* posp);
<a name="l00366"></a>00366 ssize_t <a class="code" href="acq200_8h.html#76beefe7fabdd4360119e7c7b7267b98">acq200_bridge_readAB</a> (
<a name="l00367"></a>00367         <span class="keyword">struct</span> file* file, <span class="keywordtype">char</span>* buf, <span class="keywordtype">size_t</span> count, loff_t* posp);
<a name="l00368"></a>00368 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#bd5fed5e815fc67fe41d6953a70e03c2">acq200_bridge_release</a> (<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> file *file);
<a name="l00369"></a>00369 <span class="keywordtype">int</span> <a class="code" href="acq200_8c.html#d69bc34764c71c4a1678a6c1a7e4c3a9">acq200_release</a> (<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> file *file);
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="acq200_8h.html#0077361bcb657b3dd48cc9d81ae04cf0">00371</a> <span class="preprocessor">#define ACQ32_BB_POOL_SIZE 0x100000</span>
<a name="l00372"></a><a class="code" href="acq200_8h.html#1d8bc6f1b8aa01a2aa1341917c305f19">00372</a> <span class="preprocessor"></span><span class="preprocessor">#define ACQ32_BB_POOL_ERROR 0xffffffff</span>
<a name="l00373"></a>00373 <span class="preprocessor"></span>
<a name="l00374"></a>00374 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#baa8d1496eaea193f280ad16d5a0110a">acq200_pool_create</a>(<span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *device);
<a name="l00375"></a>00375 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#5c1ed48f8634cff2af030cfeabae1392">acq200_pool_delete</a>(<span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *device);
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="keyword">struct </span>IoMapping *<a class="code" href="acq200_8h.html#b34c632ba1f45d7efa5fbb6adec88223">acq200_pool_alloc_mapping</a>(
<a name="l00378"></a>00378         <span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *device, <span class="keywordtype">int</span> direction);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#0da4551477d762b20efc21a0527e6db1">acq200_pool_free_mapping</a>(
<a name="l00381"></a>00381         <span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *device, <span class="keyword">struct</span> IoMapping *map);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 <span class="keyword">struct </span><a class="code" href="structReturnCommandHandler.html">ReturnCommandHandler</a>* 
<a name="l00384"></a>00384         <a class="code" href="acq200_8h.html#d6cb2ac61a5158f3147396723096686f">acq200_pool_alloc_rch</a>(<span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *<a class="code" href="structReturnCommandHandler.html#0b4eafd65ac6d3d109793f6c1bdecc36">device</a>);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#6728329bdf29e0ee37346581bc4012bc">acq200_pool_free_rch</a>(
<a name="l00387"></a>00387         <span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *<a class="code" href="structReturnCommandHandler.html#0b4eafd65ac6d3d109793f6c1bdecc36">device</a>,
<a name="l00388"></a>00388         <span class="keyword">struct</span> <a class="code" href="structReturnCommandHandler.html">ReturnCommandHandler</a>* rch);
<a name="l00389"></a>00389         
<a name="l00390"></a>00390 <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#629fda69b261cac058b6f8b13fbdf619">acq200_get_cpci_slot</a>(<span class="keyword">struct</span> pci_dev * pci_dev);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <span class="preprocessor">#ifdef DEBUG_MALLOC</span>
<a name="l00393"></a>00393 <span class="preprocessor"></span><span class="preprocessor">#define KMALLOC( size, flags ) dbg_kmalloc( size, flags, __FILE__, __LINE__ )</span>
<a name="l00394"></a>00394 <span class="preprocessor"></span><span class="preprocessor">#define KFREE( addr )          __dbg_kfree( addr, __FILE__, __LINE__ )</span>
<a name="l00395"></a>00395 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00396"></a><a class="code" href="acq200_8h.html#354ce7a746eed87f486d458bf004215d">00396</a> <span class="preprocessor"></span><span class="preprocessor">#define KMALLOC( size,flags )  kmalloc( size, flags )</span>
<a name="l00397"></a><a class="code" href="acq200_8h.html#fe0e0cf1e7eeed323445ab5be238d3ed">00397</a> <span class="preprocessor"></span><span class="preprocessor">#define KFREE( addr )          kfree( addr )</span>
<a name="l00398"></a>00398 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00399"></a>00399 <span class="preprocessor"></span>
<a name="l00400"></a>00400 
<a name="l00401"></a><a class="code" href="acq200_8h.html#185f0a8dc3d3ad0190b95de6cb60153c">00401</a> <span class="preprocessor">#define PCI_WINDOW_MASK(device) (dma_buf_len(device) -1)</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span>
<a name="l00403"></a>00403 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#b8e2ec81e2ebf4af7e93323b47f8ef79">acq200_device_create_file</a>(
<a name="l00404"></a>00404         <span class="keyword">struct</span> <a class="code" href="structReturnCommandHandler.html#0b4eafd65ac6d3d109793f6c1bdecc36">device</a> * dev, <span class="keyword">struct</span> device_attribute * attr,
<a name="l00405"></a>00405         <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> line);
<a name="l00406"></a>00406 
<a name="l00407"></a><a class="code" href="acq200_8h.html#23f488df63b98c0c8a440ef9334d7728">00407</a> <span class="preprocessor">#define DEVICE_CREATE_FILE(dev, attr) \</span>
<a name="l00408"></a>00408 <span class="preprocessor">        acq200_device_create_file(dev, attr, __FILE__, __LINE__)</span>
<a name="l00409"></a>00409 <span class="preprocessor"></span>
<a name="l00410"></a>00410 
<a name="l00411"></a><a class="code" href="acq200_8h.html#7f823b3b687c858225b669f08ab7896e">00411</a> <span class="preprocessor">#define COPY_TO_USER(src, dest, len) \</span>
<a name="l00412"></a>00412 <span class="preprocessor">        if (copy_to_user(src, dest, len)) { return -EFAULT; }</span>
<a name="l00413"></a>00413 <span class="preprocessor"></span>
<a name="l00414"></a><a class="code" href="acq200_8h.html#e8a3f3d221cc64f2fa06f62a42b2e4f2">00414</a> <span class="preprocessor">#define COPY_FROM_USER(src, dest, len) \</span>
<a name="l00415"></a>00415 <span class="preprocessor">        if (copy_from_user(src, dest, len)) { return -EFAULT; }</span>
<a name="l00416"></a>00416 <span class="preprocessor"></span>
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="acq200_8c.html#570d6c1958407b6249dba84a78a4159f">acq200_stub_copy_to_user</a>;
<a name="l00419"></a>00419 
<a name="l00420"></a><a class="code" href="acq200_8h.html#17df1d884d69c4d2760fb5deb3918775">00420</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="acq200_8h.html#17df1d884d69c4d2760fb5deb3918775">copyDmaBuf2IoMapping</a>(
<a name="l00421"></a>00421         <span class="keyword">struct</span> IoMapping *mapping, <span class="keyword">struct</span> <a class="code" href="structDmaBuf.html">DmaBuf</a> *dma_buf)
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423         mapping-&gt;va = dma_buf-&gt;<a class="code" href="structDmaBuf.html#a0590c89317d41622971d58fd3275a1e">va</a>;
<a name="l00424"></a>00424         mapping-&gt;pa = dma_buf-&gt;<a class="code" href="structDmaBuf.html#bac2669718be53788e8b3b3a836bc76d">pa</a>;
<a name="l00425"></a>00425         mapping-&gt;len = <a class="code" href="acq200_8h.html#db330d36ca3a1492c310f0747783b893">dma_buf_len</a>(dma_buf);
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="acq200_8h.html#d8b9ee2540ff17d2467552a9064395fe">i2o_missed_int_checker</a>(<span class="keywordtype">void</span> *arg);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="acq200_8c.html#1a4af521cbae0efae26a19c89af87bc0">acq200_handle_incoming_message</a>(<span class="keyword">struct</span> <a class="code" href="structAcq200Device.html" title="device descriptor, one per device">Acq200Device</a> *<a class="code" href="structReturnCommandHandler.html#0b4eafd65ac6d3d109793f6c1bdecc36">device</a>);
<a name="l00431"></a>00431 <span class="preprocessor">#endif </span><span class="comment">/* __ACQ200_H__ */</span>
<a name="l00432"></a>00432 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Feb 19 14:51:16 2010 for ACQ200 HOSTDRV by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.7.1 </small></address>
</body>
</html>
